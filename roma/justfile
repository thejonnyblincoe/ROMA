# ROMA Development Commands
# Use `just` command runner: https://github.com/casey/just

# Default recipe - show available commands
default:
    @just --list

# Setup development environment
setup:
    @echo "ğŸš€ Setting up ROMA development environment"
    uv sync --dev
    @echo "âœ… Development environment ready!"

# Run all tests
test:
    @echo "ğŸ§ª Running ROMA Test Suite"
    @echo "=========================="
    uv run python -m pytest tests/ -v --tb=short

# Run domain tests only
test-domain:
    @echo "ğŸ—ï¸  Domain Layer Tests"
    uv run python -m pytest tests/unit/domain/ -v

# Run application tests only  
test-app:
    @echo "âš™ï¸  Application Layer Tests"
    uv run python -m pytest tests/unit/application/ -v

# Run integration tests only
test-integration:
    @echo "ğŸ”— Integration Tests"
    uv run python -m pytest tests/integration/ -v

# Run tests with coverage
test-cov:
    @echo "ğŸ“Š Running tests with coverage"
    uv run python -m pytest tests/ --cov=src --cov-report=html --cov-report=term-missing

# Watch tests (requires pytest-watch)
test-watch:
    @echo "ğŸ‘€ Watching tests..."
    uv run pytest-watch

# Code quality checks
lint:
    @echo "ğŸ” ROMA Code Quality Checks"
    @echo "=========================="
    @just lint-ruff
    @just lint-mypy
    @echo "ğŸ‰ All code quality checks passed!"

# Run ruff linting and formatting check
lint-ruff:
    @echo "ğŸ¨ Running Ruff linting..."
    uv run ruff check src/ tests/
    @echo "ğŸ”§ Checking Ruff formatting..."
    uv run ruff format --check src/ tests/

# Type checking with mypy
lint-mypy:
    @echo "ğŸ”¬ Running MyPy type checking..."
    uv run mypy src/

# Auto-fix code formatting and linting
format:
    @echo "ğŸ¨ Auto-formatting and fixing code..."
    uv run ruff check --fix src/ tests/
    uv run ruff format src/ tests/
    @echo "âœ… Code formatted and linted!"

# Show linting statistics
lint-stats:
    @echo "ğŸ“Š Linting Statistics"
    @echo "===================="
    uv run ruff check src/ --statistics || true

# Clean build artifacts
clean:
    @echo "ğŸ§¹ Cleaning build artifacts..."
    rm -rf build/
    rm -rf dist/
    rm -rf *.egg-info/
    rm -rf .pytest_cache/
    rm -rf .coverage
    rm -rf coverage_html/
    find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
    find . -type f -name "*.pyc" -delete 2>/dev/null || true
    @echo "âœ… Clean complete!"

# Build package
build:
    @echo "ğŸ“¦ Building ROMA package..."
    uv build
    @echo "âœ… Package built!"

# Install package in development mode
install-dev:
    @echo "ğŸ”§ Installing ROMA in development mode..."
    uv pip install -e .
    @echo "âœ… Development installation complete!"

# Run performance profiling
profile:
    @echo "âš¡ Running performance profiling..."
    uv run python -m pytest tests/ -m performance --tb=short

# Generate documentation
docs:
    @echo "ğŸ“š Generating documentation..."
    uv run sphinx-build -b html docs/ docs/_build/html/
    @echo "âœ… Documentation generated in docs/_build/html/"

# Serve documentation locally
docs-serve: docs
    @echo "ğŸŒ Serving documentation at http://localhost:8000"
    cd docs/_build/html && python -m http.server 8000

# Run security checks
security:
    @echo "ğŸ”’ Running security checks..."
    uv run pip-audit
    @echo "âœ… Security checks complete!"

# Pre-commit checks (run before committing)
pre-commit: lint test
    @echo "ğŸš€ Pre-commit checks complete! Ready to commit."

# Full CI pipeline (lint, test, build)
ci: clean lint test build
    @echo "ğŸ¯ CI pipeline complete!"

# Show project structure
tree:
    @echo "ğŸŒ³ ROMA Project Structure"
    @echo "========================"
    tree -I '__pycache__|*.pyc|.git|.venv|*.egg-info|build|dist|coverage_html' -a

# Interactive Python shell with ROMA imported
shell:
    @echo "ğŸ Starting Python shell with ROMA..."
    uv run python -c "import sys; sys.path.insert(0, 'src'); import roma; print('ROMA imported successfully!'); print(f'Version: {roma.__version__}'); exec(open('/dev/stdin').read())" -i

# Quick development cycle (format, test domain)
dev: format test-domain
    @echo "ğŸ”„ Quick development cycle complete!"

# Benchmark performance
bench:
    @echo "ğŸ“ˆ Running performance benchmarks..."
    uv run python -m pytest tests/ -m benchmark --benchmark-only

# Version information
version:
    @echo "ğŸ“‹ ROMA Version Information"
    @echo "=========================="
    @uv run python -c "import sys; sys.path.insert(0, 'src'); import roma; print(f'ROMA Version: {roma.__version__}'); print(f'Python Version: {sys.version}'); import platform; print(f'Platform: {platform.platform()}')"